### Algorand: 可扩展的拜占庭协议
##### 三种挑战
1. Sybil女巫攻击拜占庭协议
2. 适用百万级别用户
3. 弹性应对拒绝服务攻击和持续稳定服务

##### 应对方式
1. Weight users: 有效用户。（节点需要余额）
2. Consensus by committee: 共识委员会。（随机选举：影响因素：Weight），面临选举人被攻击的问题。
3. Cryptographic sortition: 密码学抽签。隐秘而且无交互的选举。用户自己在本地执行VRF算法，确认自己是否被选举上。通过自己的私钥和公共信息。如果被选举上，会生成一个简短的字符串来证明。当自己打包好信息之后，只要向别人广播的时候，带上这个字符串，别人就可以验证是否真的被选举上了。
4. Participant replacement: 参与者变更。不保留任何私人状态（不受任何私人信息控制），达到每次都会变更委员会成员。

#### 目标和假设
1. Safety goal. 安全目标。诚实会接受诚实的。Eclipse attack(日蚀攻击)。
2. Liveness goal. 活跃目标。
3. Assumptions. 一般常见的假设。

强同步与弱同步，强同步可以解决活跃的目标。弱同步结果安全目标。所有用户之间有弱同步的时钟，保证相差不大。

#### 总览和思路
区块组织形式与比特币类似，使用Gossip协议去传输交易。BA提供了两种共识: final共识与tentative共识。final共识意味着这个区块已经达成了最终的共识，被稳定确认了，后续区块可以接着此区块继续连接下去。tentative共识意味着这个区块，有人能够看到同轮的其他区块。这个区块上的所有交易都处于未确认的状态。Gossip协议来传输新产生的交易。区块提案产生区块生成者们。BA协议确定最终的区块。

#### 密码学抽签 Cryptographic Sortition

#### 区块提案 Block Proposal

#### BA

#### Algorand 区块链

#### VRF应对双花攻击


### 密码抽签 cryptographic sortition
#### 选出验证者和领导者
假设在第r轮（可以理解为产生第r个区块的时间段）开始时，“种子”参数为Qr-1（表现为一个由0和1组成的长度为256的字符串），PKr-k是第r-k轮结束后系统中活跃的用户/公钥（活跃的标志是至少参与过一笔交易）的集合，其中k被称为回溯参数或安全参数。Qr-1和PKr-k属于公共知识（common knowledge）。

凭证的定义。对每一个PKr-k中的用户i，他使用自己的私钥对“种子”参数Qr-1进行电子签名后（用函数SIGi来表示）并输入哈希函数（用函数H来表示），得到自己的凭证H（SIGi(r,1,Qr-1))(函数SIGi有多个输入参数时，表示将这些参数简单串联后再进行电子签名，下同）。哈希函数的性质决定了：

1.凭证是一个近乎随机的、由0和1组成的长度为256的字符串，并且不同用户的凭证几乎不可能相同；

2.由凭证构建的2进制小数0.H(SIGi(r,1,Qr-1))（也就是将凭证字符串写到小数点后）在0和1之间均匀分布。

“潜在领导者”的选择。对0和1之间的一个数p，0.H(SIGi(r,1,Qr-1))≤p发生的概率为p，称所有满足此条件的用户为“潜在领导者”（也是这一步的“验证者”）。p使得以1-10-18的概率，在所有“潜在领导者”中，至少有一个是诚实的。

“领导者”的选择。在所有“潜在领导者”中，存在一个用户lr，其凭证按字典排序最小。也就是，对所有0.H(SIGi(r,1,Qr-1))≤p的用户i，均有H(SIGlr(r,1,Qr-1))≤H(SIGi(r,1,Qr-1))。用户lr就是第r轮的“领导者”。

“验证者”的选择。第r轮第s步（s>1）的“验证者”的产生程序与上文类似。在这一步中，每一个PKr-k中的用户i使用自己的私钥对“种子”参数Qr-1进行电子签名后并输入哈希函数，得到自己的凭证H(SIGi(r,1,Qr-1))。对0和1之间的一个数p，满足0.H(SIGi(r,1,Qr-1))≤p的用户就构成这一步的“验证者”。

#### 创建并不断完善种子参数
用Br表示第r轮结束后，拜占庭协议BA★输出的区块。如果Algorand在第r轮受到了“敌对者”攻击，Br可能是空的，也就是不含有任何真实交易记录（用符号来表示）。比如，“敌对者”可能腐化了这一轮的“领导者”，使其将两个不同的候选区块发给诚实的“验证者”。考虑到这个情况，“种子”参数的更新过程是：

Qr=H(SIGlr(Qr-1，r)),如果Br不是空区块

Qr=H（Qr-1，r）,如果Br是空区块

哈希函数的性质决定了，Qr和Qr-1之间的关系近乎随机的。回溯参数或安全参数k则保证了，“敌对者”在第r-k-1轮几乎不可能预测到Qr-1；否则，他将在第r-k轮引入恶意用户（也就是进入PKr-k），从而能影响第r轮“领导者”和“验证者”的选择。

